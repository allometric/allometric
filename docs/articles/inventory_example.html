<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="allometric">
<title>Common Inventory Use Cases • allometric</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Common Inventory Use Cases">
<meta property="og:description" content="allometric">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">allometric</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9007</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/descriptors.html">Describing a Model with Descriptors</a>
    <a class="dropdown-item" href="../articles/installing_a_model.html">Installing a Model</a>
    <a class="dropdown-item" href="../articles/inventory_example.html">Common Inventory Use Cases</a>
    <a class="dropdown-item" href="../articles/mixed_effects.html">Mixed-Effects Models</a>
    <a class="dropdown-item" href="../articles/variable_naming_system.html">Variable Naming System</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Common Inventory Use Cases</h1>
            
      
      
      <div class="d-none name"><code>inventory_example.Rmd</code></div>
    </div>

    
    
<p>This vignette covers several common forest inventory use cases that
can be covered by <code>allometric</code></p>
<div class="section level2">
<h2 id="making-predictions-of-volume-for-multiple-species">Making Predictions of Volume for Multiple Species<a class="anchor" aria-label="anchor" href="#making-predictions-of-volume-for-multiple-species"></a>
</h2>
<p>This vignette demonstrates a simple forest inventory example using
<code>allometric</code> using plot data obtained from the Forest
Inventory and Analysis (FIA) program. An example dataset is included in
the package and can be loaded using <code>data(fia_trees)</code>. Our
objective is to calculate a plot-level volumes for every plot in this
dataset.</p>
<p>Allometric predictions can be made in any manner of ways according to
the user’s preference. We will use the suite of <code>tidyverse</code>
packages to manipulate our data, but this is merely the author’s
preference. <code>allometric</code> is capable of producing predictions
using base R if preferred.</p>
<div class="section level3">
<h3 id="preparing-the-data">Preparing the Data<a class="anchor" aria-label="anchor" href="#preparing-the-data"></a>
</h3>
<p>In reading <code><a href="../reference/fia_trees.html">?fia_trees</a></code> the user will notice that all tree
species are encoded using the FIA <code>SPCD</code> numbering system.
The first task is to prepare a data frame that will translate these
codes into taxonomic groupings.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">target_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  SPCD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">202</span>, <span class="fl">263</span>, <span class="fl">15</span>, <span class="fl">122</span><span class="op">)</span>,</span>
<span>  genus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Pseudotsuga'</span>, <span class="st">'Tsuga'</span>, <span class="st">'Abies'</span>, <span class="st">'Pinus'</span><span class="op">)</span>,</span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'menziesii'</span>, <span class="st">'heterophylla'</span>, <span class="st">'concolor'</span>, <span class="st">'ponderosa'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>target_species</code> dataframe serves two purposes. First,
it allows us to link <code>genus</code> and <code>species</code>
information to <code>fia_trees</code>. Second, it allows us to easily
filter out allometric models that are not related to these types of
trees.</p>
</div>
<div class="section level3">
<h3 id="finding-appropriate-models">Finding Appropriate Models<a class="anchor" aria-label="anchor" href="#finding-appropriate-models"></a>
</h3>
<p>The user will note that <code>fia_trees</code> is composed entirely
of trees from the state of Oregon in the United States. Using
<code>dplyr</code> and <code>purrr</code> we can efficiently filter out
unnecessary models from the <code>allometric_models</code> table. Refer
to the <code><a href="../reference/allometric_models.html">?allometric_models</a></code> help page for more
information.</p>
<p>For this example, we need stem volume models for our species of
interest that, preferably, were fit using data in the state of
Oregon.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">allometric</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">stemvol_mods</span> <span class="op">&lt;-</span> <span class="va">allometric_models</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">model_type</span> <span class="op">==</span> <span class="st">"stem volume"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">stemvol_mods</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 569</span></span></code></pre>
<p>We can see that <code>stemvol_mods</code> contains a huge amount of
stem volume models. That is because <code>allometric</code> is global in
scope. Most of these models are not relavent for our needs. Next, we
will drill down and select models that were developed with data from
<code>US-OR</code> (the state of Oregon, United States).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stemvol_or_mods</span> <span class="op">&lt;-</span> <span class="va">stemvol_mods</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">region</span>, <span class="op">~</span> <span class="st">'US-OR'</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">stemvol_or_mods</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 39</span></span></code></pre>
<p>Here we see all stem volume models available fit using data from the
state of Oregon. Still, the amount of models is very high. Next, we will
select only our target species.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stemvol_or_spc_mods</span> <span class="op">&lt;-</span> <span class="va">stemvol_or_mods</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">target_species</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'genus'</span>, <span class="st">'species'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">stemvol_or_spc_mods</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 12</span></span></code></pre>
<p>Finally, something a bit more digestible. Even still, we have
multiple models per species. The last step is to ensure that each of
these remaining models are compatible with our available data.
<code>fia_trees</code> only contains <code>DIA</code>, the diameter at
breast height, and <code>HT</code> the total height of the tree. In
<code>allometric</code> these covariates are standardized as
<code>dsob</code> and <code>hst</code> respectively. See the <a href="https://brycefrank.com/allometric/articles/variable_naming_system.html" class="external-link">Variable
Naming System</a> for more information. Using some clever filtering, we
can find which models are compatible with this set of covariates.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stemvol_or_spc_dia_ht_mods</span> <span class="op">&lt;-</span> <span class="va">stemvol_or_spc_mods</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">covt_name</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'dsob'</span>, <span class="st">'hst'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The call to <code>map_lgl</code> answers the question, “which models
contain only two covariates that are named <code>dsob</code> and
<code>hst</code>”? Only a handful of models remain.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stemvol_or_spc_dia_ht_mods</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">##   id       model…¹ country region family genus species model      pub_id famil…²</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> fe138f46 stem v… &lt;chr&gt;   &lt;chr&gt;  Pinac… Abies concol… <span style="color: #949494;">&lt;FxdEffcM&gt;</span> poude… &lt;chr&gt;  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 7cd15805 stem v… &lt;chr&gt;   &lt;chr&gt;  Pinac… Pinus ponder… <span style="color: #949494;">&lt;FxdEffcM&gt;</span> poude… &lt;chr&gt;  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 87f5ecd3 stem v… &lt;chr&gt;   &lt;chr&gt;  Pinac… Pseu… menzie… <span style="color: #949494;">&lt;FxdEffcM&gt;</span> bruce… &lt;chr&gt;  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> a570828b stem v… &lt;chr&gt;   &lt;chr&gt;  Pinac… Pseu… menzie… <span style="color: #949494;">&lt;FxdEffcM&gt;</span> bruce… &lt;chr&gt;  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 2b079499 stem v… &lt;chr&gt;   &lt;chr&gt;  Pinac… Pseu… menzie… <span style="color: #949494;">&lt;FxdEffcM&gt;</span> poude… &lt;chr&gt;  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 3e8447f2 stem v… &lt;chr&gt;   &lt;chr&gt;  Pinac… Tsuga hetero… <span style="color: #949494;">&lt;FxdEffcM&gt;</span> poude… &lt;chr&gt;  </span></span>
<span><span class="co">## <span style="color: #949494;"># … with 3 more variables: covt_name &lt;list&gt;, pub_year &lt;dbl&gt;, SPCD &lt;dbl&gt;, and</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   abbreviated variable names ¹​model_type, ²​family_name</span></span></span></code></pre>
<p>At this stage, we only need to determine a single model for
Pseudotsuga menziesii. We will decide to select only those models from
<code>poudel_2019</code>, a recent study that contains the volume models
for the species we need.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_set</span> <span class="op">&lt;-</span> <span class="va">stemvol_or_spc_dia_ht_mods</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pub_id</span> <span class="op">==</span> <span class="st">"poudel_2019"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SPCD</span>, <span class="va">model</span><span class="op">)</span></span>
<span><span class="va">final_set</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">##    SPCD model     </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>    15 <span style="color: #949494;">&lt;FxdEffcM&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>   122 <span style="color: #949494;">&lt;FxdEffcM&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>   202 <span style="color: #949494;">&lt;FxdEffcM&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>   263 <span style="color: #949494;">&lt;FxdEffcM&gt;</span></span></span></code></pre>
<p>At last we have all four species attached to one allometric model,
and we can proceed with prediction. If the above steps seem cumbersome,
fear not, the “Storing an Internal Set of Equations for Routine Use”
section resolves these issues.</p>
</div>
<div class="section level3">
<h3 id="making-volume-predictions">Making Volume Predictions<a class="anchor" aria-label="anchor" href="#making-volume-predictions"></a>
</h3>
<p>To make a volume prediction correctly, we must know the order of the
arguments to the allometric function. Inspecting the first model in our
set reveals this order.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_set</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>call <span class="op">=</span> <span class="fu"><a href="../reference/model_call.html">model_call</a></span><span class="op">(</span><span class="va">model</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">##    SPCD model      call               </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>    15 <span style="color: #949494;">&lt;FxdEffcM&gt;</span> vsia = f(dsob, hst)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>   122 <span style="color: #949494;">&lt;FxdEffcM&gt;</span> vsia = f(dsob, hst)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>   202 <span style="color: #949494;">&lt;FxdEffcM&gt;</span> vsia = f(dsob, hst)</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>   263 <span style="color: #949494;">&lt;FxdEffcM&gt;</span> vsia = f(dsob, hst)</span></span></code></pre>
<p>The <code>model_call</code> function shows that
<code>vsa = f(dsob, hst)</code> is the allometric function call for each
model we have specified, which means that the diameter of the stem
outside bark at breast height (<code>dsob</code>) is the first argument
and the total height of the stem (<code>hst</code>) is the second
argument.</p>
<p>Using <code>final_set</code>, we can easily merge the models to our
tree-list and make predictions. Predictions made in this manner are done
using the <code>predict_allo</code> function.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_vols</span> <span class="op">&lt;-</span> <span class="va">final_set</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">fia_trees</span>, by <span class="op">=</span> <span class="st">"SPCD"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>vol_m3 <span class="op">=</span> <span class="fu"><a href="../reference/predict_allo.html">predict_allo</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">DIA</span> <span class="op">*</span> <span class="fl">2.54</span>, <span class="va">HT</span> <span class="op">*</span> <span class="fl">0.3048</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>vol_cuft <span class="op">=</span> <span class="va">vol_m3</span> <span class="op">*</span> <span class="fl">35.3147</span><span class="op">)</span></span></code></pre></div>
<p><code>predict_allo</code> takes each model in the <code>model</code>
column and applies it to the covariates, <code>DIA</code> and
<code>HT</code> assigned in the function call. Aggregating to the
plot-level we obtain</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_vols</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">PLOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>vol_ac <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">vol_cuft</span> <span class="op">*</span> <span class="va">TPA_UNADJ</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 10 × 2</span></span></span>
<span><span class="co">##     PLOT vol_ac</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494;">[m^3]</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     1  <span style="text-decoration: underline;">7</span>881.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     2 <span style="text-decoration: underline;">22</span>768.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     3 <span style="text-decoration: underline;">11</span>289.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     4  <span style="text-decoration: underline;">1</span>021.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     5  <span style="text-decoration: underline;">3</span>188.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     6 <span style="text-decoration: underline;">15</span>176.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     7 <span style="text-decoration: underline;">11</span>862.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     8 <span style="text-decoration: underline;">19</span>900.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     9  <span style="text-decoration: underline;">8</span>188.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>    10  <span style="text-decoration: underline;">4</span>507.</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="storing-an-internal-set-of-equations-for-routine-use">Storing an Internal Set of Equations for Routine Use<a class="anchor" aria-label="anchor" href="#storing-an-internal-set-of-equations-for-routine-use"></a>
</h2>
<p>It is unlikely that most organizations need all models stored in
<code>allometric_models</code> for routine use. For example, the Forest
Inventory and Analysis (FIA) program has specified sets of allometric
models over the years that are used to produce cubic volumes and
biomasses for the national FIA database. Subsets of the
<code>allometric_models</code> table can be prepared by analysts and
stored locally as <code>RDS</code> files, which can then be used in
routine analysis or even as components of other software packages.</p>
<p>For example, we can save the model table we created in the last
section</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">final_set</span>, <span class="st">'./my_directory/final_set.RDS'</span><span class="op">)</span></span></code></pre></div>
<p>It can be reloaded and used readily in other software</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">'./my_directory/final_set.RDS'</span><span class="op">)</span></span></code></pre></div>
<p>If you will be using other <code>allometric</code> functionality in
your software, (e.g., <code>predict_allo</code>) it will be necessary to
run <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library(allometric)</a></code> to gain access to those
functions.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Bryce Frank.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
