<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="allometric">
<title>Advanced Model Searching • allometric</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced Model Searching">
<meta property="og:description" content="allometric">
<meta property="og:image" content="http://brycefrank.com/allometric/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">allometric</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/advanced_searching.html">Advanced Model Searching</a>
    <a class="dropdown-item" href="../articles/descriptors.html">Describing a Model with Descriptors</a>
    <a class="dropdown-item" href="../articles/installing_a_model.html">Installing a Model</a>
    <a class="dropdown-item" href="../articles/mixed_effects.html">Mixed-Effects Models</a>
    <a class="dropdown-item" href="../articles/variable_naming_system.html">Variable Naming System</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Advanced Model Searching</h1>
            
      
      
      <div class="d-none name"><code>advanced_searching.Rmd</code></div>
    </div>

    
    
<p>Upon installation the user is able to access models stored in
<code>allometric_models</code>. This represents a dataframe containing
highly structured data describing the models contained in the package.
Using packages like <code>dplyr</code> and <code>purrr</code> we will be
able to create expressive search queries to find the models we need.
This vignette shares some motivating examples. After following the
examples, users should feel confident writing their own expressive
queries.</p>
<div class="section level3">
<h3 id="finding-contributing-authors">Finding Contributing Authors<a class="anchor" aria-label="anchor" href="#finding-contributing-authors"></a>
</h3>
<p>Let’s say we want to search for any model with <code>'Hann'</code> as
a contributing author. This can be done with some elegant use of
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter</a></code> and <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map_lgl</a></code>. Before
beginning, it is helpful to know that <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map_lgl</a></code>
returns a list of TRUE/FALSE values as it “maps” over a list of
input.</p>
<p>Consider the vector <code>auth &lt;- c('Hann', 'Doe')</code>, I could
check if this vector contains <code>'Hann'</code> using the expression
<code>'Hann' %in% auth</code>. Knowing this, let’s take a look at
filtering out all models containing <code>Hann</code> as an author:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hann_models</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">allometric_models</span>,</span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">family_names</span>, <span class="op">~</span> <span class="st">'Hann'</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hann_models</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">##   id       compo…¹ measure country region family genus species model      pub_id</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> adeaf86e stem    diamet… &lt;chr&gt;   &lt;chr&gt;  Cupre… Calo… <span style="color: #BB0000;">NA</span>      <span style="color: #949494;">&lt;FxdEffcM&gt;</span> hann_…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> f85c0bd6 stump   diamet… &lt;chr&gt;   &lt;chr&gt;  Cupre… Calo… <span style="color: #BB0000;">NA</span>      <span style="color: #949494;">&lt;FxdEffcM&gt;</span> hann_…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 6aa0bc1e stem    volume  &lt;chr&gt;   &lt;chr&gt;  Cupre… Calo… <span style="color: #BB0000;">NA</span>      <span style="color: #949494;">&lt;FxdEffcM&gt;</span> hann_…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> fd071661 stem    diamet… &lt;chr&gt;   &lt;chr&gt;  Pinac… Abies concol… <span style="color: #949494;">&lt;FxdEffcM&gt;</span> hann_…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 8419eccf stump   diamet… &lt;chr&gt;   &lt;chr&gt;  Pinac… Abies concol… <span style="color: #949494;">&lt;FxdEffcM&gt;</span> hann_…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 0ddbb194 stem    volume  &lt;chr&gt;   &lt;chr&gt;  Pinac… Abies concol… <span style="color: #949494;">&lt;FxdEffcM&gt;</span> hann_…</span></span>
<span><span class="co">## <span style="color: #949494;"># … with 3 more variables: family_names &lt;list&gt;, covt_names &lt;list&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   pub_year &lt;dbl&gt;, and abbreviated variable name ¹​component</span></span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hann_models</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 24</span></span></code></pre>
<p>Picking apart the above code block, we see that we are using the
standard <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter</a></code> function on the
<code>allometric_models</code> dataframe. The second argument is a call
using <code>purrr:map_lgl</code>, which will map over each list
(contained as elements in the <code>family_names</code> column). The
second argument to this function, <code>~ 'Hann' %in% .</code> is itself
a function that checks if <code>'Hann'</code> is in the current list.
Imagine we are marching down each row of <code>allometric_models</code>,
<code>.</code> represents the element of <code>family_names</code> we
are considering, which is itself a list of author names.</p>
</div>
<div class="section level3">
<h3 id="finding-first-authors">Finding First Authors<a class="anchor" aria-label="anchor" href="#finding-first-authors"></a>
</h3>
<p>Maybe we are only interested in models where <code>'Hann'</code> is
the first author. Using a simple modification we can easily do this.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hann_first_author_models</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">allometric_models</span>,</span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">family_names</span>, <span class="op">~</span> <span class="st">'Hann'</span> <span class="op">==</span> <span class="va">.</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hann_first_author_models</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">##   id       compo…¹ measure country region family genus species model      pub_id</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> adeaf86e stem    diamet… &lt;chr&gt;   &lt;chr&gt;  Cupre… Calo… <span style="color: #BB0000;">NA</span>      <span style="color: #949494;">&lt;FxdEffcM&gt;</span> hann_…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> f85c0bd6 stump   diamet… &lt;chr&gt;   &lt;chr&gt;  Cupre… Calo… <span style="color: #BB0000;">NA</span>      <span style="color: #949494;">&lt;FxdEffcM&gt;</span> hann_…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 6aa0bc1e stem    volume  &lt;chr&gt;   &lt;chr&gt;  Cupre… Calo… <span style="color: #BB0000;">NA</span>      <span style="color: #949494;">&lt;FxdEffcM&gt;</span> hann_…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> fd071661 stem    diamet… &lt;chr&gt;   &lt;chr&gt;  Pinac… Abies concol… <span style="color: #949494;">&lt;FxdEffcM&gt;</span> hann_…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 8419eccf stump   diamet… &lt;chr&gt;   &lt;chr&gt;  Pinac… Abies concol… <span style="color: #949494;">&lt;FxdEffcM&gt;</span> hann_…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 0ddbb194 stem    volume  &lt;chr&gt;   &lt;chr&gt;  Pinac… Abies concol… <span style="color: #949494;">&lt;FxdEffcM&gt;</span> hann_…</span></span>
<span><span class="co">## <span style="color: #949494;"># … with 3 more variables: family_names &lt;list&gt;, covt_names &lt;list&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   pub_year &lt;dbl&gt;, and abbreviated variable name ¹​component</span></span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hann_first_author_models</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 18</span></span></code></pre>
<p>We can see that <code>'Hann'</code> is the first author for 18 models
in this package.</p>
</div>
<div class="section level3">
<h3 id="finding-a-model-with-specific-data-requirements">Finding a Model with Specific Data Requirements<a class="anchor" aria-label="anchor" href="#finding-a-model-with-specific-data-requirements"></a>
</h3>
<p>We can even check for models that contain certain types of data
requirements. For example, the following block finds diameter-height
models, specifically models that use diameter outside bark at breast
height as the <em>only</em> covariate. The utility here is obvious,
since many inventories are vastly limited by their available tree
measurements.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dia_ht_models</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">allometric_models</span>,</span>
<span>    <span class="va">measure</span> <span class="op">==</span> <span class="st">'height'</span>,</span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">covt_names</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="va">.</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">'dsob'</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dia_ht_models</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 23</span></span></code></pre>
<p>Breaking this down, we have the first condition
<code>measure=='height'</code> selecting only models concerned with
heights as a response variable. The second line maps over each element
of the <code>covt_names</code> column, which is a character vector. The
<code>.</code> represents a given character vector for that row. First,
we ensure that the vector is only one element in size using
<code>length(.)==1</code>, then we ensure that the first (and only)
element of this vector is equal to <code>'dsob'</code>, (diameter
outside bark at breast height). In this case, 23 are available in the
package.</p>
</div>
<div class="section level3">
<h3 id="finding-a-model-for-a-region">Finding a Model for a Region<a class="anchor" aria-label="anchor" href="#finding-a-model-for-a-region"></a>
</h3>
<p>By now the user should be sensing a pattern. We can apply the exact
same logic as the <em>Finding Contributing Authors</em> section to find
all models developed using data from <code>US-OR</code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">us_or_models</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">allometric_models</span>,</span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">region</span>, <span class="op">~</span> <span class="st">"US-OR"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">us_or_models</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 59</span></span></code></pre>
<p>We can see that 59 allometric models are defined for the state of
Oregon, US.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Bryce Frank.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
